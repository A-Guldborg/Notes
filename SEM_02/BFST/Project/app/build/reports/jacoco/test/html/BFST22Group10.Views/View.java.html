<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>View.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">app</a> &gt; <a href="index.source.html" class="el_package">BFST22Group10.Views</a> &gt; <span class="el_source">View.java</span></div><h1>View.java</h1><pre class="source lang-java linenums">package BFST22Group10.Views;

import BFST22Group10.App;
import BFST22Group10.Controller;
import javafx.fxml.FXMLLoader;
import javafx.geometry.Point2D;
import javafx.scene.canvas.GraphicsContext;
import javafx.scene.image.Image;
import javafx.scene.paint.Color;
import javafx.scene.shape.FillRule;
import javafx.scene.shape.SVGPath;
import javafx.scene.transform.NonInvertibleTransformException;
import javafx.stage.Stage;

import java.io.IOException;
import java.io.InputStream;
import java.util.ArrayList;

public class View {
    public final MapCanvas mapCanvas;
    public static float LON_MULTIPLIER;


<span class="nc" id="L24">    public View(Stage primaryStage, Controller controller, float lonMultiplier) throws IOException {</span>
<span class="nc" id="L25">        LON_MULTIPLIER = lonMultiplier;</span>
<span class="nc" id="L26">        FXMLLoader loader = new FXMLLoader(App.class.getResource(&quot;/View.fxml&quot;));</span>
<span class="nc" id="L27">        loader.setController(controller);</span>
<span class="nc" id="L28">        primaryStage.setScene(loader.load());</span>
<span class="nc" id="L29">        controller = loader.getController();</span>
<span class="nc" id="L30">        mapCanvas = controller.mapCanvas;</span>
<span class="nc" id="L31">        primaryStage.setTitle(&quot;X-Plore&quot;);</span>
<span class="nc" id="L32">        Image icon = new Image(this.getClass().getResourceAsStream(&quot;/xploreX.png&quot;));</span>
<span class="nc" id="L33">        primaryStage.getIcons().add(icon);</span>
<span class="nc" id="L34">        primaryStage.show();</span>
<span class="nc" id="L35">        mapCanvas.widthProperty().bind(primaryStage.widthProperty());</span>
<span class="nc" id="L36">        mapCanvas.heightProperty().bind(primaryStage.heightProperty());</span>
<span class="nc" id="L37">    }</span>

    public void zoomToBox(float minLat, float maxLat, float minLon, float maxLon, float offset) {
<span class="nc" id="L40">        minLat -= offset; maxLat += offset; minLon -= offset; maxLon += offset;</span>
<span class="nc" id="L41">        mapCanvas.resetZoom();</span>
<span class="nc" id="L42">        double factorHeight = mapCanvas.getHeight() / Math.abs(maxLat - minLat);</span>
<span class="nc" id="L43">        double factorWidth = mapCanvas.getWidth() / Math.abs(maxLon - minLon);</span>
<span class="nc" id="L44">        mapCanvas.zoom(Math.min(factorWidth, factorHeight), (minLon + maxLon) * LON_MULTIPLIER / 2, -(minLat + maxLat) / 2);</span>
<span class="nc" id="L45">        mapCanvas.panToMiddle(mapCanvas.getWidth(), mapCanvas.getHeight());</span>
<span class="nc" id="L46">    }</span>

    public void drawLines(float[][] xCoords, float[][] yCoords, Color color, double lineWidth, Boolean blackWhite, boolean drawPrecise){
<span class="nc" id="L49">        GraphicsContext canvas = mapCanvas.getGraphicsContext2D();</span>
<span class="nc bnc" id="L50" title="All 2 branches missed.">        canvas.setStroke(blackWhite ? color : color.grayscale());</span>
<span class="nc" id="L51">        canvas.setLineWidth(lineWidth);</span>
<span class="nc bnc" id="L52" title="All 2 branches missed.">        if (xCoords == null) return;</span>
<span class="nc" id="L53">        drawHelper(xCoords, yCoords, canvas, drawPrecise);</span>
<span class="nc" id="L54">        canvas.stroke();</span>
<span class="nc" id="L55">    }</span>

    public void drawPolygon(float[][] xCoords, float[][] yCoords, Color color, Boolean blackWhite){
<span class="nc" id="L58">        GraphicsContext canvas = mapCanvas.getGraphicsContext2D();</span>
<span class="nc bnc" id="L59" title="All 2 branches missed.">        if (xCoords == null) return;</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">        canvas.setStroke(blackWhite ? color :  color.grayscale());</span>
<span class="nc bnc" id="L61" title="All 2 branches missed.">        canvas.setFill(blackWhite ? color : color.grayscale());</span>
<span class="nc" id="L62">        canvas.setFillRule(FillRule.EVEN_ODD);</span>
<span class="nc" id="L63">        drawHelper(xCoords, yCoords, canvas, false);</span>
<span class="nc" id="L64">        canvas.fill();</span>
<span class="nc" id="L65">    }</span>

    public void drawHelper(float[][] xCoords, float[][] yCoords, GraphicsContext canvas, boolean drawPrecise) {
<span class="nc" id="L68">        int incrementer = 10000 / (int) mapCanvas.getZoomLvl();</span>
<span class="nc" id="L69">        canvas.beginPath();</span>
<span class="nc bnc" id="L70" title="All 2 branches missed.">        for(int i = 0; i &lt; xCoords.length; i++) {</span>
<span class="nc" id="L71">            canvas.moveTo(LON_MULTIPLIER * xCoords[i][0], -yCoords[i][0]);</span>
<span class="nc bnc" id="L72" title="All 2 branches missed.">            for(int j = 0; j &lt; xCoords[i].length; j++) {</span>
<span class="nc" id="L73">                canvas.lineTo(LON_MULTIPLIER * xCoords[i][j], -yCoords[i][j]);</span>
<span class="nc bnc" id="L74" title="All 2 branches missed.">                if (!drawPrecise) j += incrementer;</span>
            }
<span class="nc" id="L76">            canvas.lineTo(LON_MULTIPLIER * xCoords[i][xCoords[i].length-1], -yCoords[i][yCoords[i].length-1]);</span>
        }
<span class="nc" id="L78">    }</span>

    // debug
    public float[] getBoundaryOfScreenBox(Boolean debug) throws NonInvertibleTransformException {
<span class="nc" id="L82">        float leftX = 0, topY = 0;</span>
<span class="nc" id="L83">        float rightX = (float) mapCanvas.getWidth();</span>
<span class="nc" id="L84">        float bottomY = (float) mapCanvas.getHeight();</span>
<span class="nc" id="L85">        int offSet = 100;</span>

<span class="nc bnc" id="L87" title="All 2 branches missed.">        Point2D leftTop = debug ? mapCanvas.inverseTransform(leftX+offSet, topY+offSet) : mapCanvas.inverseTransform(leftX, topY);</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">        Point2D rightBottom = debug ? mapCanvas.inverseTransform(rightX-offSet, bottomY-offSet) : mapCanvas.inverseTransform(rightX, bottomY);</span>

<span class="nc" id="L90">        return new float[]{(float)rightBottom.getY(), (float)leftTop.getY(), (float)leftTop.getX(), (float)rightBottom.getX()};</span>
    }

    public void drawBox(float[] box) {
<span class="nc" id="L94">        GraphicsContext canvas = mapCanvas.getGraphicsContext2D();</span>
<span class="nc" id="L95">        canvas.beginPath();</span>
<span class="nc" id="L96">        canvas.setStroke(Color.BLACK);</span>
<span class="nc" id="L97">        canvas.setLineWidth(1 / Math.sqrt(mapCanvas.getTransform().determinant()));</span>
<span class="nc" id="L98">        canvas.moveTo(box[3] * LON_MULTIPLIER, -box[0]);</span>
<span class="nc" id="L99">        canvas.lineTo(box[3] * LON_MULTIPLIER, -box[1]);</span>
<span class="nc" id="L100">        canvas.lineTo(box[2] * LON_MULTIPLIER, -box[1]);</span>
<span class="nc" id="L101">        canvas.lineTo(box[2] * LON_MULTIPLIER, -box[0]);</span>
<span class="nc" id="L102">        canvas.lineTo(box[3] * LON_MULTIPLIER, -box[0]);</span>
<span class="nc" id="L103">        canvas.stroke();</span>
<span class="nc" id="L104">    }</span>

    public void drawZoomRuler(float meters) {
        try {
<span class="nc" id="L108">            Point2D point = mapCanvas.inverseTransform(20, (float) mapCanvas.getHeight() - 75);</span>
<span class="nc" id="L109">            double longitudeOffset = meters / 111139;</span>
<span class="nc" id="L110">            GraphicsContext canvas = mapCanvas.getGraphicsContext2D();</span>
<span class="nc" id="L111">            canvas.beginPath();</span>
<span class="nc" id="L112">            canvas.setStroke(Color.GRAY);</span>
<span class="nc" id="L113">            canvas.setLineWidth(2 / Math.sqrt(mapCanvas.getTransform().determinant()));</span>
<span class="nc" id="L114">            canvas.moveTo(point.getX() * LON_MULTIPLIER, -point.getY());</span>
<span class="nc" id="L115">            canvas.lineTo(point.getX() * LON_MULTIPLIER + longitudeOffset, -point.getY());</span>
<span class="nc" id="L116">            canvas.stroke();</span>
<span class="nc" id="L117">        } catch (NonInvertibleTransformException e) {</span>
<span class="nc" id="L118">            e.printStackTrace();</span>
<span class="nc" id="L119">        }</span>
<span class="nc" id="L120">    }</span>
    
    public void drawPath(ArrayList&lt;Float&gt; lon, ArrayList&lt;Float&gt; lat) {
<span class="nc" id="L123">        GraphicsContext canvas = mapCanvas.getGraphicsContext2D();</span>
<span class="nc" id="L124">        canvas.beginPath();</span>
<span class="nc" id="L125">        canvas.setStroke(Color.RED);</span>
<span class="nc" id="L126">        canvas.setLineWidth(2 / Math.sqrt(mapCanvas.getTransform().determinant()));</span>
<span class="nc" id="L127">        canvas.moveTo(lon.get(0)*LON_MULTIPLIER, -lat.get(0));</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">        for (int i = 1; i &lt; lon.size(); i++) {</span>
<span class="nc" id="L129">            canvas.lineTo(lon.get(i)*LON_MULTIPLIER, -lat.get(i));</span>
        }
<span class="nc" id="L131">        canvas.stroke();</span>
<span class="nc" id="L132">    }</span>

    public void drawAddressPoint(float latPoint, float lonPoint, Color color) {
<span class="nc" id="L135">        GraphicsContext canvas = mapCanvas.getGraphicsContext2D();</span>
<span class="nc" id="L136">        SVGPath path = new SVGPath();</span>
<span class="nc" id="L137">        path.setContent(&quot;m 0.00005 -0.0002 q 0.00005 0.00005 -0.00005 0.0002 q -0.0001 -0.00015 -0.00005 -0.0002 q 0.00005 -0.00005 0.0001 0 z m -0.00005 0.00002 c 0.00004 -0 0.00004 0.00006 -0 0.00006 c -0.00004 -0 -0.00004 -0.00006 0 -0.00006 z&quot;);</span>
<span class="nc" id="L138">        canvas.beginPath();</span>
<span class="nc" id="L139">        canvas.setFill(color);</span>
<span class="nc" id="L140">        canvas.moveTo(lonPoint * LON_MULTIPLIER, -latPoint);</span>
<span class="nc" id="L141">        canvas.appendSVGPath(path.getContent());</span>
<span class="nc" id="L142">        canvas.fill();</span>
<span class="nc" id="L143">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>